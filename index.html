<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Telegram Bot Control Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Simple helper for toasts
    function toast(msg, type = "info") {
      const colors = {
        info: "bg-blue-600",
        success: "bg-green-600",
        warn: "bg-amber-600",
        error: "bg-red-600",
      };
      const el = document.createElement("div");
      el.className = `${colors[type]} text-white px-4 py-2 rounded-xl shadow-lg fixed bottom-6 right-6 z-50 animate-bounce`;
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 2200);
    }

    async function apiCall(token, method, payload) {
      const url = `https://api.telegram.org/bot${token}/${method}`;
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload || {}),
      });
      const data = await res.json().catch(() => ({}));
      if (!res.ok || data.ok === false) {
        const desc = data?.description || `HTTP ${res.status}`;
        throw new Error(desc);
      }
      return data.result ?? data;
    }

    function savePrefs() {
      const token = document.getElementById("botToken").value.trim();
      const chatId = document.getElementById("chatId").value.trim();
      const parseMode = document.getElementById("parseMode").value;
      if (token) localStorage.setItem("tg_token", token);
      if (chatId) localStorage.setItem("tg_chat", chatId);
      localStorage.setItem("tg_parse", parseMode);
      toast("Saved locally (browser only)", "success");
    }

    function loadPrefs() {
      const token = localStorage.getItem("tg_token") || "";
      const chatId = localStorage.getItem("tg_chat") || "";
      const parseMode = localStorage.getItem("tg_parse") || "MarkdownV2";
      document.getElementById("botToken").value = token;
      document.getElementById("chatId").value = chatId;
      document.getElementById("parseMode").value = parseMode;
      if (token) fetchMe();
    }

    async function fetchMe() {
      const token = document.getElementById("botToken").value.trim();
      const status = document.getElementById("botStatus");
      if (!token) {
        status.innerHTML = `<span class="text-amber-600">Enter a token, then Test</span>`;
        return;
      }
      status.textContent = "Testing‚Ä¶";
      try {
        const me = await apiCall(token, "getMe", {});
        status.innerHTML = `‚úÖ <b>${me.first_name || "Bot"}</b> (<code>@${me.username || "unknown"}</code>)`;
        toast("Bot connected", "success");
      } catch (e) {
        status.innerHTML = `‚ùå <span class="text-red-600">${e.message}</span>`;
        toast(e.message, "error");
      }
    }

    async function sendMessage() {
      const token = document.getElementById("botToken").value.trim();
      const chatId = document.getElementById("chatId").value.trim();
      const text = document.getElementById("message").value;
      const parseMode = document.getElementById("parseMode").value;
      const disablePreview = document.getElementById("disablePreview").checked;
      const disableNotif = document.getElementById("disableNotif").checked;

      if (!token) return toast("Token required", "warn");
      if (!chatId) return toast("Chat ID or @channel required", "warn");
      if (!text) return toast("Write a message first", "warn");

      const btn = document.getElementById("sendBtn");
      btn.disabled = true; btn.classList.add("opacity-60");
      try {
        const payload = {
          chat_id: chatId,
          text,
          parse_mode: parseMode || undefined,
          disable_web_page_preview: disablePreview || undefined,
          disable_notification: disableNotif || undefined,
        };
        const res = await apiCall(token, "sendMessage", payload);
        document.getElementById("result").textContent = JSON.stringify(res, null, 2);
        toast("Message sent", "success");
      } catch (e) {
        document.getElementById("result").textContent = `Error: ${e.message}`;
        toast(e.message, "error");
      } finally {
        btn.disabled = false; btn.classList.remove("opacity-60");
      }
    }

    async function sendPhoto() {
      const token = document.getElementById("botToken").value.trim();
      const chatId = document.getElementById("chatId").value.trim();
      const photoUrl = document.getElementById("photoUrl").value.trim();
      const caption = document.getElementById("photoCaption").value;
      const parseMode = document.getElementById("parseMode").value;

      if (!token) return toast("Token required", "warn");
      if (!chatId) return toast("Chat ID required", "warn");
      if (!photoUrl) return toast("Photo URL required", "warn");

      const btn = document.getElementById("sendPhotoBtn");
      btn.disabled = true; btn.classList.add("opacity-60");
      try {
        const payload = {
          chat_id: chatId,
          photo: photoUrl,
          caption: caption || undefined,
          parse_mode: caption ? (parseMode || undefined) : undefined,
        };
        const res = await apiCall(token, "sendPhoto", payload);
        document.getElementById("result").textContent = JSON.stringify(res, null, 2);
        toast("Photo sent", "success");
      } catch (e) {
        document.getElementById("result").textContent = `Error: ${e.message}`;
        toast(e.message, "error");
      } finally {
        btn.disabled = false; btn.classList.remove("opacity-60");
      }
    }

    function toggleToken() {
      const el = document.getElementById("botToken");
      el.type = el.type === "password" ? "text" : "password";
    }

    document.addEventListener("DOMContentLoaded", loadPrefs);
  </script>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <div class="max-w-3xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold tracking-tight">Telegram Bot <span class="text-blue-600">Control Panel</span></h1>
      <p class="text-slate-600 mt-1">Send messages via your bot token. Nothing is uploaded; token is stored in your browser if you hit Save.</p>
    </header>

    <div class="grid gap-4 md:grid-cols-2">
      <div class="bg-white rounded-2xl shadow p-5">
        <h2 class="font-semibold mb-3">Connection</h2>
        <label class="block text-sm font-medium text-slate-700">Bot Token</label>
        <div class="flex gap-2 mt-1">
          <input id="botToken" type="password" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" class="w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-blue-500 px-3 py-2" />
          <button onclick="toggleToken()" class="px-3 py-2 rounded-xl border bg-slate-100">üëÅÔ∏è</button>
        </div>
        <div class="mt-3 flex items-center gap-2">
          <button onclick="fetchMe()" class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:brightness-110">Test Token</button>
          <button onclick="savePrefs()" class="px-4 py-2 rounded-xl bg-slate-800 text-white hover:brightness-110">Save</button>
        </div>
        <p id="botStatus" class="mt-3 text-sm text-slate-700">Not connected</p>
      </div>

      <div class="bg-white rounded-2xl shadow p-5">
        <h2 class="font-semibold mb-3">Defaults</h2>
        <label class="block text-sm font-medium text-slate-700">Chat ID or @channel</label>
        <input id="chatId" type="text" placeholder="123456789 or @yourchannel" class="w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-blue-500 px-3 py-2 mt-1" />
        <div class="mt-3">
          <label class="block text-sm font-medium text-slate-700">Parse Mode</label>
          <select id="parseMode" class="w-full rounded-xl border-slate-300 px-3 py-2 mt-1">
            <option>MarkdownV2</option>
            <option>HTML</option>
            <option value="">(none)</option>
          </select>
        </div>
        <div class="mt-3 grid grid-cols-2 gap-3">
          <label class="inline-flex items-center gap-2 text-sm"><input id="disablePreview" type="checkbox" class="rounded"/> Disable link previews</label>
          <label class="inline-flex items-center gap-2 text-sm"><input id="disableNotif" type="checkbox" class="rounded"/> Send silently</label>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow p-5 mt-4">
      <h2 class="font-semibold mb-3">Send Text Message</h2>
      <textarea id="message" rows="5" placeholder="Type your message‚Ä¶" class="w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-blue-500 px-3 py-2"></textarea>
      <div class="mt-3 flex gap-3">
        <button id="sendBtn" onclick="sendMessage()" class="px-5 py-2.5 rounded-xl bg-green-600 text-white hover:brightness-110">Send Message</button>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow p-5 mt-4">
      <h2 class="font-semibold mb-3">Send Photo (URL)</h2>
      <label class="block text-sm font-medium text-slate-700">Photo URL</label>
      <input id="photoUrl" type="url" placeholder="https://example.com/image.jpg" class="w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-blue-500 px-3 py-2 mt-1" />
      <label class="block text-sm font-medium text-slate-700 mt-3">Caption (optional)</label>
      <textarea id="photoCaption" rows="3" placeholder="Caption‚Ä¶" class="w-full rounded-xl border-slate-300 focus:ring-2 focus:ring-blue-500 px-3 py-2"></textarea>
      <div class="mt-3 flex gap-3">
        <button id="sendPhotoBtn" onclick="sendPhoto()" class="px-5 py-2.5 rounded-xl bg-indigo-600 text-white hover:brightness-110">Send Photo</button>
      </div>
    </div>

    <div class="bg-slate-900 text-slate-50 rounded-2xl p-5 mt-6">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold">Result / Logs</h3>
        <button onclick="document.getElementById('result').textContent=''" class="px-3 py-1 rounded-lg bg-slate-700">Clear</button>
      </div>
      <pre id="result" class="mt-3 whitespace-pre-wrap text-sm"></pre>
    </div>

    <footer class="text-xs text-slate-500 mt-6">
      <p><strong>Heads up:</strong> This panel calls Telegram's Bot API from your browser. If your browser blocks cross‚Äëorigin requests, you may need to run this from a simple backend proxy. Never share your bot token publicly.</p>
    </footer>
  </div>
</body>
</html>
